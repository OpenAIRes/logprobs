<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>logprobs viewer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    body      { font: 16px/1.4 system-ui, sans-serif; margin: 0; padding: 1rem; }
    #tokens   { max-width: 60ch; line-height: 1.9; }
    .token    { cursor: pointer; white-space: pre; }
    .token:hover { background: #ffeaa7; }

    #tooltip  {
      position: absolute;
      background: #fff;
      border: 1px solid #ccc;
      padding: .5rem;
      font: 14px/1.3 monospace;
      box-shadow: 0 2px 6px #0003;
      z-index: 1000;
    }
    #tooltip.hidden { display:none; }
    #tooltip table { border-collapse: collapse; margin-top: .25rem; }
    #tooltip th,
    #tooltip td { padding: .15rem .5rem; border: 1px solid #ddd; }
    #loading  { color: #888; }
  </style>
</head>

<body>
  <div id="loading">Loading tokens…</div>
  <div id="tokens" hidden></div>
  <div id="tooltip" class="hidden"></div>

<script>
let tokens = [];

async function loadTokens () {
  try {
    const res  = await fetch('logprobs.json');
    const data = await res.json();
    tokens     = data.choices[0].logprobs.content;

    const container = document.getElementById('tokens');
    tokens.forEach((t, i) => {
      const span = document.createElement('span');
      span.textContent  = t.token;
      span.dataset.idx  = i;
      span.className    = 'token';
      span.addEventListener('click', showTopLogprobs);
      container.appendChild(span);
    });

    // swap loading indicator for tokens
    document.getElementById('loading').remove();
    container.hidden = false;

  } catch (err) {
    document.getElementById('loading').textContent =
      'Error loading logprobs.json: ' + err.message;
  }
}

function showTopLogprobs (e) {
  e.stopPropagation();
  const i      = +e.currentTarget.dataset.idx;
  const { token, top_logprobs } = tokens[i];

  const rows = top_logprobs
               .slice(0, 10)
               .map(r => `<tr><td>${r.token}</td>
                             <td>${r.logprob.toFixed(2)}</td>
                             <td>${Math.exp(r.logprob).toFixed(4)}</td></tr>`)
               .join('');

  const tip = document.getElementById('tooltip');
  tip.innerHTML = `<strong>‘${token}’</strong><br>
                   <table><tr><th>token</th><th>log p</th><th>p</th></tr>${rows}</table>`;
  tip.classList.remove('hidden');

  const rect = e.target.getBoundingClientRect();
  tip.style.left = `${rect.left + window.scrollX}px`;
  tip.style.top  = `${rect.bottom + window.scrollY + 4}px`;
}

document.addEventListener('click', () =>
  document.getElementById('tooltip').classList.add('hidden')
);

window.addEventListener('DOMContentLoaded', loadTokens);
</script>
</body>
</html>
